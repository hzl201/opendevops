# 分布式部署

::: tip
基于IIS的部署方式，在各矿井或矿业公司部署主平台web服务、帆软报表服务、监测监控服务、gis一张图地图及协同、综合自动化服务等。
:::

## 安装操作系统

::: tip
本安装及设置教程适用于使用Windows2008R2为操作系统的服务器，目的是让服务器实现下列环境。
:::


- 语言脚本环境：ASP.Net4.0
- 数据库环境： MSSQL 2014
- FTP环境：FileZilla
- 常见组件：

**一、系统准备**

- Windows2008R2原版安装文件、服务器硬件驱动程序(RAID磁盘阵列卡驱动、网卡驱动等)、SQL　SERVER　2014安装盘、FileZilla Server、winpe、rufus、镜像制作GimageX。Windows2008R2和SQL　SERVER　2014安装文件可以购买正版光盘或其他途径获得。Windows2008R2最好是原版，SQL　SERVER　2014可以选择企业版或者标准版。服务器硬件驱动应该在购买服务器的同时附带了。
- FileZilla Server等均可以通过购买或者其他途径来获得。winpe、rufus、GimageX安装文件可以到其官方网站免费下载，或到其他下载网站获得。

**二、系统安装**
    
- 分区：服务器的硬盘推荐1T，分成了3个区，C盘做系统盘(100-200G)，D盘做数据库和软件盘(500G)，E盘做备份盘(300G)，以NTFS格式4K对齐对3个区进行格式化。一般情况下服务器的磁盘阵列已经设置好了，不需要重新设置，可以使用winpe进行分区，只要winpe集成有服务器的磁盘阵列卡驱动，都能正常分区。

- 安装系统：启动服务器，设置BIOS为光盘启动，重启，插入Windows2008R2安装盘至光驱中，根据提示安装操作系统。若没有光盘，可以使用rufus将镜像烧录到U盘，可根据服务器实际情况选择MBR还是UEFI模式，其中最新的服务器一般都是UEFI引导的，烧录完以后需将服务器的RAID磁盘阵列卡驱动解压后、网卡驱动安装包复制到U盘备用。也可以自行将最新的补丁和驱动程序打包到wim镜像中。

- 根据服务器的启动设置选择u盘启动，联想ibm服务器一般是F12，顺利执行U盘引导，若在格式化磁盘的界面发现找不到磁盘，则需要加载RAID磁盘阵列卡驱动，找到U盘对应目录的驱动程序。如图2-1所示。
![](/uP6SZd.png)
- 图2-1 加载RAID磁盘阵列卡驱动

- 设置登录时不弹出“管理您的服务器”窗口：启动计算机，弹出“管理您的服务器”窗口，勾选窗口左下方的“登录时不要显示此页”。

- 启动自动更新：选择初始配置任务--启动自动更新和反馈--启动自动更新和反馈。

- 下载并安装更新：选择初始配置任务--下载并安装更新--更改设置--重要更新--选择下载更新，但是让我选择是否安装更新--确定。

- 修改计算机名：选择初始配置任务--提供计算机名和域--更改--输入计算机名--确定--重启。

- 安装驱动：系统安装更新完毕，进入系统，按照主板-显卡-声卡-网卡-其他设备的顺序安装各类驱动程序。主要是安装网卡驱动，网卡正常后请联系机房管理员配置ip(有可能要绑定网卡MAC地址)并开放端口。

常用端口配置说明：

一张图地图服务：8400

一张图协同服务：8056

一张图文档浏览服务：8405

Web服务:80

SQL SERVER: TCP-1433、UDP-1434

NTP时间同步：UDP-123

**三、安装WEB服务器**

- (1).进入服务器管理器
- (2).选择角色，添加角色
- (3).选择WEB服务器，下一步
- (4).选择除FTP服务器外的所有选项，下一步
- (5).安装

**四、安装.NET3.5功能**

- (1).进入服务器管理器
- (2).选择功能，添加功能
- (3).选择.net　Framework　3.51功能
- (4).下一步，安装

**五、防火墙设置**

默认关闭防火墙。

**六、远程访问服务**

6.1.启动远程访问服务

- (1).选择服务器管理器--启用远程桌面
- (2).选择允许运行任意版本远程桌面的计算机连接(较不安全)。备注：方便多种版本Windows远程管理服务器。
- (3).确定

6.2.修改远程访问服务端口

- (1).在开始--运行菜单里,输入regedit,进入注册表编辑,按下面的路径进入修改端口的地方
- (2).HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\Terminal　Server\WinStations\RDP-Tcp
- (3).找到右侧的　&quot;PortNumber&quot;，用十进制方式显示，默认为3389，改为(例如)6666端口
- (4).HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal　Server\Wds\rdpwd\Tds\tcp
- (5).找到右侧的　&quot;PortNumber&quot;，用十进制方式显示，默认为3389，改为同上的端口
- (6).在控制面板--Windows　防火墙--高级设置--入站规则--新建规则
- (7).选择端口--协议和端口--TCP/特定本地端口：同上的端口
- (8).下一步，选择允许连接
- (9).下一步，选择公用
- (10).下一步，名称：远程桌面-新(TCP-In)，描述：用于远程桌面服务的入站规则，以允许RDP通信。[TCP　同上的端口]
- (11).删除远程桌面(TCP-In)规则
- (12).重新启动计算机

堵住资源共享隐患：打开“本地连接”界面，选择“属性”，左键点击“Microsoft网络客户端”，再点击“卸载”，在弹出的对话框中“是”确认卸载。点击“Microsoft网络的文件和打印机共享”，再点击“卸载”，在弹出的对话框中选择“是”确认卸载。

6.3解除Netbios和TCP/IP协议的绑定：

打开“本地连接”界面，选择“属性”，在弹出的“属性”框中双击“Internet协议版本(TCP/IPV4)”，点击“属性”，再点击“高级”—“WINS”，选择“禁用TCP/IP上的NETBIOS”，点击“确认”并关闭本地连接属性。

禁止默认共享：点击“开始”—“运行”，输入“Regedit”，打开注册表编辑器，打开注册表项“HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters”，在右边的窗口中新建Dword值，名称设为AutoShareServer，值设为“0”。

**七、虚拟内存设置**

修改虚拟内存的位置或禁用虚拟内存两者选择其一，在内存足够大的情况下可以禁用虚拟内存。如果内存不是非常大，还是修改虚拟内存到硬盘的非系统盘。一般情况下不建议禁用虚拟内存。
 
 - (1)、修改虚拟内存的位置：右键点击“计算机”，选择“属性”—“高级系统设置”—“高级”—“设置”—“高级”—“虚拟内存”—“更改”，取消勾选“自动管理所有驱动器的分页文件大小”，在“驱动器”选择框里面选中系统盘，选择“无分页文件”，在非系统盘如D盘，选择“自定义大小”，输入“初始大小”和“最大值”，点击“设置”，并确认修改。

- (2)、禁用虚拟内存：右键点击“计算机”，选择“属性”—“高级系统设置”—“高级”—“设置”—“高级”—“虚拟内存”—“更改”，取消勾选“自动管理所有驱动器的分页文件大小”，对所有驱动器都选择“无分页文件”，然后点击“设置”并确认修改。

**八、本地安全策略**

- (1)更改管理员账号和来宾账号：本地策略-安全选项-账户，重命名系统管理员账户，把Administrator改名。重命名来宾账户，把Guest用户改名为Administrator，不过是什么权限都没有的那种，然后打开记事本，一阵乱敲，复制，粘贴到"密码"里去。

- (2)组策略：计算机配置—Windows设置—安全设置—本地策略—安全选项交互式登陆：不显示最后的用户名(启用)

- (3)关闭自动播放：
控制面板，自动播放，取消勾选，保存。
点击“开始”—“运行”，输入“Gpedit.msc”，打开组策略编辑器，依次展开“计算机配置”—“管理模板”—“Windows组件”，在右侧窗口找到“自动播放策略”选项并打开，双击右侧关闭自动播放，在打开的对话框上部选择“已启用”，在对话框下部选择“所有驱动器”，点击“确定”完成设置。

**九、开机自动登录设置**

- (1).开始菜单搜索框输入 “netplwiz” 按回车或“Win+R”组合键打开“运行”框内输入“netplwiz”在弹出的“用户帐户”窗口中，把“要使用本机，用户必须输入用户名和密码”前面的复选框中的勾去掉。然后点击“应用”。
![](/uP6wJx.png)

- (2).弹出“自动登录”窗口，输入自己的“用户名”和“密码”，然后点击“确定"回到”用户帐户“窗口；再点击”确定“即可。在下次登录时就会生效。
![](/uPc3tI.png)

**十、启动项设置**

- (1).开始-启动，加入软件快捷方式。

- (2).[Windows Server 2012配置开机启动项](https://www.cnblogs.com/dreamer-fish/p/3504628.html)需使用资源管理器打开这个目录

```shell
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp
```

**十一、密码免更改设置**

开始-管理工具-计算机管理，系统工具-本地用户和组-用户，在右侧选择administrator，右键属性，更改为密码永不过期。如图11-1所示。
![](/uPcWB4.png)
图11-1 管理员属性设置

**十二、漏洞修复**

操作系统安装好，把所有软件都安装好。优先打高危漏洞。打完重启。

- (1).先补高危漏洞

360高危漏洞免疫工具下载地址：[http://www.360.cn/webzhuanti/mianyigongju.html](http://www.360.cn/webzhuanti/mianyigongju.html)

- (2).再打常规补丁

使用360安全卫士等工具把所有补丁慢慢打上。打完重启。

**十三、病毒查杀**

- (1).安装杀毒软件

操作系统安装好，把所有软件都安装好。安装杀毒软件，并更新病毒库，把自家程序添加到白名单，若查杀出病毒后需要重启再次杀毒。

- (2).升级病毒库

使用杀毒软件定期升级病毒库，保证杀毒效率。

- (3).勒索病毒防治

勒索病毒只能防御，中招之后无法修复，唯一有效的操作就是平时多进行数据异地备份。

**十四、备份系统：**

至此重启服务器，对刚刚做好的操作系统做一个备份。备份推荐用GimageX。



## 环境准备

> 部署安装之前，你应该了解下每个模块的用途. 


**注意**

- 不同的服务器可选择性的部署服务
- 综合自动化服务单独部署（要求的环境必须是32位服务器）

**建议配置**

- 系统： windows server 2008 R2 X64 或 windows server 2012 r2版本（推荐2012 r2），综合自动化服务器只能部署在32位操作系统，建议若没有32位操作系统，可挂载虚拟机。
- CPU：  4Core+
- 内存：  16G+（若是监测监控服务器建议32G）
- 磁盘：  >=500G+（若是监测监控服务器建议1T+）


**准备基础环境**

> 基础环境需要用到以下服务。

- 建议版本
  - .NET4.0
  - Sql Server 2014 R2 X64
  - python2.7（安全巡检和地质编录使用的环境）


`注意：
   不要安装32位MSSQL软件，32位的版本只能调用4G以下的内存。`
   
- 若是win server 2012的操作系统，安全sql server 2014 r2数据库时需要.Net3.5环境，外网环境可以直接安装，内网环境需要从镜像文件里提取sxs文件夹，（WindowsServer2012R2镜像文件迅雷链接：ed2k://|file|cn_windows_server_2012_r2_vl_with_update_x64_dvd_4051059.iso|4683122688|BD0B95997679F83A4EE2D062865D8E64|/ ）下载的镜像文件里有sources目录有sxs文件夹，指定备用源路径为此文件夹。

- 若是Windows 7 和 Windows Server 2008 R2 需要下载 32位或64位 Service Pack 1 (KB976932)才能安装sql server 2014 r2。下载地址https://www.microsoft.com/zh-cn/download/details.aspx?id=5842


**调试网络**

需提前调试好煤矿的这些网络，实现服务器之间互联互通。
> 工业网（视频厂家硬盘录像机服务器、综合自动化厂家服务器）
> 生产网（安全监测厂家服务器、人员定位厂家服务器、束管监测厂家服务器）
> 办公室内网（应力与微震厂家服务器、水文监测厂家服务器）
> 集团公司与矿业公司的VPN专线（用于接通集团公司web服务器和数据库服务器）



**安装IIS服务**

> 用于搭建web平台。
`建议开发人员直接进行操作，创建web网站后默认使用80端口，第一次打开需web需要注册web平台。`

**安装服务器监测程序**
> 用于监测服务器cpu、内存、磁盘的使用情况。
> ![](/noPcXE9pwjvJIlf.jpg)
`直接复制ServerMonitorService程序目录到D盘，然后运行ServerMonitorService.exe主程序，选择好该服务器的用途并保存设置。`

**平台web自动更新服务**
> 用于定期更新web网站的代码，这样每次开发人员提交修改后就能自动推送到测试环境服务器，等运维人员和开发人员将新功能测试通过以后，进行生产环境代码的更新。
`注意：
   要先在D盘新建upload目录，并拷贝wget.exe文件到C:\Windows\System32文件夹下，安装7z解压缩工具到c盘默认目录。`


**安装python环境**
> 用于搭建地质编录服务和安全巡检服务
> python版本2.7

**安装定时诊断服务**
> 用于系统考核中报表及文档上传情况的检查。

**安装进程监控服务**
> 用于自动重启监测监控接口程序和厂家转换接口程序。

**安装FTP服务**
> 用于接收监测厂家传输的数据。

**安装监测监控数据接入服务**
> 用于读取安全监测、人员定位、束管、水文、应力和微震厂家数据和转发报警信息。

**安装定时诊断服务**
> 用于人机环管技的诊断。
- ![](/Ks2lIMyuPJah8og.jpg)

**安装帆软报表服务**
> 用于平台报表资料的填报。

**安装三级预警服务**

**安装系统考核、预测预警、大数据挖掘等服务**
- 停止服务-关掉程序-打开程序-启动服务
- ![](/XyOe7tqSpZlivh6.jpg)

**安装厂家数据转换服务（可选）**
> 用于将安全监测、人员定位、束管、水文、应力和微震厂家数据从厂家数据库中读取出来，按照龙软转换协议生成文件，
`注意：
    目前安全监测、人员定位厂家最多，接口程序稳定性也最好，水文厂家转换接口程序的稳定性一直不是很好。`

**安装时间同步服务（可选）**
> 用于监测监控同步服务器时间为北京时间。

**基础依赖部署完毕**


## 项目前端

> 若以前未部署过该项目，则直接从源码编译一份webui目录。
> 若以前在其他地方已经部署过，则直接将以前的web目录打包复制到新的web服务器上。

- 前端的web配置文件主要是根目录下的`Web.config`和`App_Data\config`目录下的`base.config`文件
- 测试一下其他内网浏览器是否能打开web页面

**第一次部署都需要联系开发人员进行web目录的注册**

**项目前端 部署完毕**


## 管理后端

`webui-admin`是基于 框架  风格的API 实现后台管理（在这里似乎不能称之为后端，因为没有专门从框架中分离出后端）,搭配使用`webui`前端组成的一套后台用户、主要权限以及系统管理的解决方案（提供登录，注册 密码修改 鉴权 用户管理 角色管理 权限管理 前端组件管理 前端路由管理 通知服务API 系统基础信息接口）

**部署**
web目录参数只要配置好就能使用。需联系开发人员进行配置。

**修改相关配置**

**创建数据库**

| 矿端一张图服务器数据库名称 | 说明 | 备注 | 推荐部署位置 |
| :-: | :-: | :-: | :-: |
| EarlyWarn | 综合自动化监测库 |  | 集团业务数据库服务器 |
| LKJT_Base_1.4.8 |  集团用户主库 | 存储组织机构及用户信息 | 集团业务数据库服务器 |
| LKJT_BDDM | 集团综合调度、生产技术业务库  |  | 集团业务数据库服务器 |
| LKJT_Business | 集团业务逻辑库 |  | 集团业务数据库服务器 |
| LKJT_DCDB | 集团地测防治水业务库 |  | 集团业务数据库服务器 |
| LKJT_DigitalArchives | 集团数字档案业务库 |  | 集团业务数据库服务器 |
| LKJT_DW | 综合预警 | DWEntities | 集团业务数据库服务器 |
| LKJT_Emergency | 集团应急救援业务库 |  | 集团业务数据库服务器 |
| LKJT_FXGK |  |  | 集团业务数据库服务器 |
| LKJT_HydrologicalMonitor | 集团水文监测中心库 |  | 集团业务数据库服务器 |
| LKJT_MonitorCenter | 集团监测监控中心库 |  | 集团业务数据库服务器 |
| LKJT_MonitorWarning | 集团动态诊断库 |  | 集团业务数据库服务器 |
| LKJT_PersonLocation_Note | 人员定位节点库 |  | 集团业务数据库服务器 |
| LKJT_PersonLocationCenter | 集团人员定位中心库 |  | 集团业务数据库服务器 |
| LKJT_SysManage | 集团考核统计业务库 | SysManageEntities | 集团业务数据库服务器 |
| LKJT_VideoCameras_1.4 | 视频 |  | 集团业务数据库服务器 |
| LKJT_WorkFlow | 工作流 |  | 集团业务数据库服务器 |
| LKJT_YTSF | 集团一通三防业务库 |  | 集团业务数据库服务器 |
| OneMap | 集团一张图 |  | 集团业务数据库服务器 |
| SafeManager | 安全管理 |  | 集团业务数据库服务器 |
| TECHENPOWER |  |  | 集团业务数据库服务器 |
| USRMS | 集团三违库 |  | 集团业务数据库服务器 |
| YQFZ_Base_1.4.8 |  |  | 集团业务数据库服务器 |
| YQFZ_BDDM |  |  | 集团业务数据库服务器 |
| YQFZ_OneMap |  |  | 集团业务数据库服务器 |
| 临矿储量 | 集团地测专业储量业务库 |  | 集团业务数据库服务器 |
| 3D_XX（XX为煤矿简称） | 三维监测数据库 | 同步安全监测、人员定位数据到三维，可在三维调取并展示。 | 矿端监测监控服务器 |
| LKJT_HydrologicalMonitor_XX（XX为煤矿简称） | 水文监测节点库 | 存储矿端水文实时和报警数据 | 矿端监测监控服务器 |
| LKJT_MinePressure_XX（XX为煤矿简称） | 应力与微震监测节点库 | 存储矿端应力和微震的实时和报警数据 | 矿端监测监控服务器 |
| LKJT_PersonLocation_Note_XX（XX为煤矿简称） | 人员定位监测节点库 | 存储矿端人员定位实时和报警数据 | 矿端监测监控服务器 |
| LKJT_SafeyMonitor_Node_XX（XX为煤矿简称） | 安全监测监测节点库 | 存储矿端安全监测实时和报警数据 | 矿端监测监控服务器 |
| XXXGIS（XXX为煤矿简称） | 矿端一张图gis数据库 | 存储矿端一张图矢量图纸数据，不是附件上传形式。 | 矿端一张图服务器 |
| XXXDICE（或地质测量库） | 矿端地质测量数据库 | 存储矿端地质测量数据 | 矿端 一张图服务器 |

**帆软报表**
> 报表修改
> 报表启动
> 报表同步

**管理后端 部署完毕**

## GIS协同、地图及文档浏览服务

**协同服务**

> 主要作用是gis软件后台管理及使用客户端进行图纸更新。
> ![](/yrYvdPs8f4H6unI.jpg)
- 安装gis软件后注册软件，数据库可以在另一台主机上，然后调用该主机的数据库即可。主程序是龙软gis3.2安装目录里的LrSvrConfTool.exe。需配置一下gis协同服务，注意：不要多个协同服务调用同一个数据库，只能有一个协同服务。启动速度快，但若有新图层添加后需手动重启该服务。进行配置后调用co_server.exe开启服务。


**地图服务**

> 主要作用是在web平台进行一张图的展示。
> ![](/q2mMPviwJy7unoW.jpg)
- 有图纸入库后，可以使用地图服务。主程序是龙软gis3.2安装目录里的LrSvrConfTool.exe。默认读取admin账号的地图图层分类及图层信息。启动缓慢。进行配置后调用map_server.exe开启服务。

**文档浏览服务**

> 主要作用是平台的上传下载菜单上传文件后可以进行在线预览。
> ![](/ovTBjlepih1FxMC.jpg)
- 主程序是龙软gis3.2安装目录里的LrSvrConfTool.exe。找一张龙软lfmx格式的图纸（有无内容均可），放在指定目录下，选择地图服务，不调用数据库，而是调用文件，指定工作目录和工作名。数据源类型选file。进行配置后调用map_server.exe开启服务。

**注意：文档浏览服务必须部署在web业务系统服务器上。**

测试通过后把所有的gis服务勾选监控，并把LrSvrConfTool.exe程序设置为开机启动项即可。

**GIS协同、地图及文件浏览服务 部署完毕**

## 监测监控后台

**搭建FTP服务**

- 本教程只适合曲靖、临矿集团、陕煤集团。
- 1.安装ftp软件
在监测监控服务器安装FileZilla_Server软件到操作系统，一路下一步即可。
- 2.创建ftp目录
- 在D盘新建ftp目录，创建以下子目录，详见表1。
-  表1 ftp目录说明

| 序号 | 目录名称           | 说明 |
|----|----------------|----|
| 1  | anquanjiance   | 安全监测上传数据  |
| 2  | kuangya        | 矿压上传数据  |
| 3  | renyuandingwei |  人员定位上传数据  |
| 4  | shuiwen |  水文上传数据  |
| 5  | weizhen |  微震上传数据  |
| 6  | yingli |   应力上传数据 |

- 根据需要还要在这些目录下面创建煤矿编码文件夹和LOG文件夹，用于存储上传监测数据和已读取的历史数据。如下图所示。

- ![](/KdEu0e.png)
- 3.创建用户名
初始化用户名和密码为用户名ftpuser，密码LONGruan123，在ftp管理界面编辑用户，如下图所示。
- ![](/KdEKTH.png)
- 添加用户名称，再设置密码，然后启用该帐户。
- ![](/KdEQkd.png)
- 4.权限配置
添加该目录，并配置权限，不要勾选目录的删除权限。确定以后保存配置。如下图所示。
- ![](/KdEltA.png)
- 5.测试上传
- 在其他主机上打开资源管理，输入ftp://ip，此ip为监测监控主机的ip，输入用户名和密码，登录到ftp目录，进行上传和删除测试。

**监测数据接入与调试**

- 监测类数据接入

目前完成word文档的编写，请参考：矿井监测数据接入实施手册。下载地址：[矿井监测数据接入实施手册](https://pan.baidu.com/s/1O_4s-bDITxi4iT8xCftsZQ) 链接: https://pan.baidu.com/s/1O_4s-bDITxi4iT8xCftsZQ 提取码: nj7s

**监测接口程序设置开机启动项**

- 目的：实现接口程序的自动监测，若未运行，则启动接口程序；若已运行但60秒内无响应，则重启接口程序。

- 使用进程监控工具定期重启龙软接口程序。
- 参考：[服务器接口程序自动监测2.0](https://www.zybuluo.com/hzl201/note/1165702)

1.下载[进程监控小工具(RestartOnCrash)--全网独家汉化版](http://www.csource.com.cn/read-317-1.html)，解压缩程序到一个文件夹，如d：\temp，在此文件夹下创建log.txt文件作为日志记录。

![](/iIgkYD7qPlNWQdj.jpg)

运行汉化版后的主程序界面：

![](/hM7INDUcLl1GxYo.jpg)

2.将日志文件的设置与路径相关联，勾选“将事件记录到文件中”，在下面的...里配置路径为d:\temp\log.txt。

![](/laC6k8KvoQ3NwD7.jpg)

3.设置监测无响应的时间(宽限期默认60秒)，主程序设置为开机自动启动，启动后最小化。
4.添加需要监测的程序。点击添加，依次填入需要监测的程序路径，监测条件，（2）若勾选“已经不再运行”，则被监测的程序未运行，则会自动启动该程序，（4）里也需要选路径。

![](/osrWLl7tdJZ9CKQ.jpg)

设置完以后，需要修改时，可以在已配置的列里右键，选择编辑或删除。

![](/FYobTMt7hfAqvU9.jpg)

5.写一个批处理，用于重启所有接口程序，删除历史文件，并设置为每天定时执行。
在桌面上新建"一键启动接口程序2.bat”文件，执行时先关闭监控程序，再关闭所有接口程序，清理垃圾文件后重启监控程序。把脚本放置在开机启动项里，内容如下：

```    
@echo off
ping 127.0.0.1 -n 5 >nul
echo 正在关闭接口程序
    
taskkill /f /im RestartOnCrash汉化版.exe
ping 127.0.0.1 -n 5 >nul
    
taskkill /f /im SafetyMonitor.exe
ping 127.0.0.1 -n 5 >nul
    
ping 127.0.0.1 -n 5 >nul 
echo 正在清除系统垃圾文件，请稍等...... 
del /f /s /q C:\inetpub\logs\LogFiles\FTPSVC2\*.*
 
echo 清除缓存完成！
ping 127.0.0.1 -n 5 >nul
    
echo 正在重新打开程序
start D:\temp\RestartOnCrash汉化版.exe
    
ping 127.0.0.1 -n 2 >nul 
echo 执行完毕。此脚本将于60秒后自动关闭！
ping 127.0.0.1 -n 60 >nul
```

**注意：不能多开需要监测的程序，若遇到多开情况，请关闭所有程序以后，再执行批处理。主程序关闭后就无法实现监测了，所以，最小化即可。**


**视频接入**

1. 需要在厂家的视频录像机上单独创建用户并接入视频信号。
2. 使用IE11浏览器，并已经安装插件。
3. 三网能互相访问。办公网、工业网、生产网。视频一般处于工业网，视频厂家有海康威视、宇视之类。
4. 硬盘录像机上已创建了对应的用户。如地面办公楼是一个用户。
5. 在平台上录入视频的配置信息，获取视频。

**监测监控后台 部署完毕**




## 移动端部署

> 主要功能是使用移动设备的客户端查询一张图、统计数据、并简单录入三违隐患数据。
> 移动端是基于H5最新技术进行打造的，安全性较高。但由于移动客户端手机机能限制，无法做到像PC端一样的数据录入，只能进行简单的查询和录入操作。
- 目前移动端只有安卓平台的客户端，暂无苹果ios平台的客户端。

**移动端 部署完毕**